<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mark Attendance</title>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp, getDoc, doc } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  let currentAdmin = null;

  onAuthStateChanged(auth, async (user) => {
    if (!user) { window.location.href = "admin.html"; return; }

    const adminDoc = await getDoc(doc(db, "admins", user.uid));
    currentAdmin = adminDoc.data();
    document.getElementById("adminEmail").textContent = user.email;

    if (!currentAdmin.isSuper) {
      document.getElementById("branchSelect").value = currentAdmin.branch;
      document.getElementById("branchSelect").disabled = true;
    }
  });

  window.logoutAdmin = () => signOut(auth).then(() => window.location.href="admin.html");

  window.markAttendance = async () => {
    const name = document.getElementById("nameInput").value.trim();
    const role = document.getElementById("roleSelect").value;
    const className = document.getElementById("classInput").value.trim();
    const course = document.getElementById("courseInput").value.trim();
    const branch = document.getElementById("branchSelect").value;

    if (!name || !role || !className || !course || !branch) {
      alert("Please fill all fields!");
      return;
    }

    await addDoc(collection(db, "attendance"), {
      name,
      role,
      class: className,
      course,
      branch,
      timestamp: serverTimestamp(),
      status: "Present ‚úÖ"
    });

    alert("Attendance marked successfully!");
    document.getElementById("attendanceForm").reset();

    if (!currentAdmin.isSuper) document.getElementById("branchSelect").value = currentAdmin.branch;
  };
</script>

<style>
body { font-family: "Segoe UI", Arial, sans-serif; background:#f4f7f9; padding:20px; color:#333; }
header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
h1 { color:#0078d7; }
input, select, button { padding:8px 14px; border-radius:6px; border:1px solid #ccc; font-size:14px; margin:5px 0; }
button { background:#0078d7; color:white; border:none; cursor:pointer; font-weight:bold; }
button:hover { background:#005fa3; }
.logout-btn { background:#dc3545; } .logout-btn:hover { background:#b02a37; }
form { background:white; padding:20px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.05); max-width:500px; }
</style>
</head>
<body>

<header>
  <h1>üìù Mark Attendance</h1>
  <div>
    <span>üë§ <b id="adminEmail">Loading...</b></span>
    <button class="logout-btn" onclick="logoutAdmin()">Logout</button>
  </div>
</header>

<form id="attendanceForm" onsubmit="event.preventDefault(); markAttendance();">
  <label>Full Name:</label>
  <input type="text" id="nameInput" placeholder="Enter full name">

  <label>Role:</label>
  <select id="roleSelect">
    <option value="">Select Role</option>
    <option value="Student">Student</option>
    <option value="Teacher">Teacher</option>
  </select>

  <label>Class:</label>
  <input type="text" id="classInput" placeholder="e.g., Vacation Classes">

  <label>Course:</label>
  <input type="text" id="courseInput" placeholder="e.g., Agric Science">

  <label>Branch:</label>
  <select id="branchSelect">
    <option value="Afra Odumase">Afra Odumase</option>
    <option value="Edwenase">Edwenase</option>
    <option value="Accra">Accra</option>
    <option value="Takoradi">Takoradi</option>
    <option value="Tamale">Tamale</option>
  </select>

  <button type="submit">‚úÖ Mark Attendance</button>
</form>

</body>
</html>
